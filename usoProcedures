CREATE DATABASE IF NOT EXISTS VET;
USE VET;
 
CREATE TABLE IF NOT EXISTS CLIENTE(
    ID_CLI INTEGER,
    NOME_CLI VARCHAR(40) NOT NULL,
    EMAIL_CLI VARCHAR(40) NOT NULL,
    SENHA_CLI CHAR(20) NOT NULL,
    DTNASCIMENTO_CLI DATE NOT NULL,
    DTCADASTRO_CLI DATE NOT NULL,
    PRIMARY KEY(ID_CLI)
);
 
CREATE TABLE IF NOT EXISTS PACIENTE(
    ID_PA INTEGER,
    ID_CLI INT,
    NOME_PA VARCHAR(40) NOT NULL,
    SINTOMAS VARCHAR(40) NOT NULL,
    ESPECIE VARCHAR(30) NOT NULL,
    IDADE TINYINT NOT NULL,
    PRIMARY KEY(ID_PA),
    FOREIGN KEY(ID_CLI) REFERENCES CLIENTE(ID_CLI)
);
 
CREATE TABLE IF NOT EXISTS MEDICO(
    ID_ME INTEGER,
    NOME_ME VARCHAR(40) NOT NULL,
    CRM VARCHAR(40) NOT NULL,
    PRIMARY KEY(ID_ME)
);
 
CREATE TABLE IF NOT EXISTS CONSULTA(
    ID_CON INTEGER,
    ID_ME INT,
    ID_PA INT,
    DATACON DATETIME NOT NULL,
    VALOR CHAR(20),
    PRIMARY KEY(ID_CON),
    FOREIGN KEY(ID_ME) REFERENCES MEDICO(ID_ME),
    FOREIGN KEY(ID_PA) REFERENCES PACIENTE(ID_PA)
);
 
DELIMITER $$
 
CREATE PROCEDURE INSERIR_CLI(
    IN ACAO INT,
    CODIGO INT,
    IN NOME_CLI VARCHAR(40),
    IN EMAIL_CLI VARCHAR(40),
    IN SENHA_CLI CHAR(20),
    IN DTNASCIMENTO_CLI DATE,
    IN DTCADASTRO_CLI DATE
)
BEGIN
    IF ACAO = 1 THEN
        INSERT INTO CLIENTE
        (NOME_CLI, EMAIL_CLI, SENHA_CLI, DTNASCIMENTO_CLI, DTCADASTRO_CLI)
        VALUES (NOME_CLI, EMAIL_CLI, SENHA_CLI, DTNASCIMENTO_CLI, DTCADASTRO_CLI);
    ELSE
        IF ACAO = 2 THEN
            UPDATE CLIENTE
            SET NOME_CLI = NOME_CLI, 
                EMAIL_CLI = EMAIL_CLI, 
                SENHA_CLI = SENHA_CLI, 
                DTNASCIMENTO_CLI = DTNASCIMENTO_CLI, 
                DTCADASTRO_CLI = DTCADASTRO_CLI
            WHERE ID_CLI = CODIGO;
        ELSE
            SELECT * FROM CLIENTE;
        END IF;
    END IF;
END $$
 
DELIMITER ;
 
CALL INSERIR_CLI(1, 0, 'VITORIA', 'VITORIA@GMAIL', '1243', '2009-09-07', '2023-03-02');
SELECT * FROM CLIENTE;
 
DELIMITER $$
 
CREATE PROCEDURE INSERIR_PA(
    IN ACAO INT,
    CODIGO INT,
    IN ID_CLI INT,
    IN NOME_PA VARCHAR(40),
    IN SINTOMAS VARCHAR(40),
    IN ESPECIE VARCHAR(30),
    IN IDADE TINYINT
)
BEGIN
    IF ACAO = 1 THEN
        INSERT INTO PACIENTE
        (ID_CLI, NOME_PA, SINTOMAS, ESPECIE, IDADE)
        VALUES (ID_CLI, NOME_PA, SINTOMAS, ESPECIE, IDADE);
    ELSE
        IF ACAO = 2 THEN
            UPDATE PACIENTE
            SET ID_CLI = ID_CLI, 
                NOME_PA = NOME_PA, 
                SINTOMAS = SINTOMAS, 
                ESPECIE = ESPECIE, 
                IDADE = IDADE
            WHERE ID_PA = CODIGO;
        ELSE
            SELECT * FROM PACIENTE;
        END IF;
    END IF;
END $$
 
DELIMITER $$
 
CREATE PROCEDURE INSERIR_ME(
    IN ACAO INT,
    CODIGO INT,
    IN NOME_ME VARCHAR(40),
    IN CRM VARCHAR(40)
)
BEGIN
    IF ACAO = 1 THEN
        INSERT INTO MEDICO
        (NOME_ME, CRM)
        VALUES (NOME_ME, CRM);
    ELSE
        IF ACAO = 2 THEN
            UPDATE MEDICO
            SET NOME_ME = NOME_ME, CRM = CRM
            WHERE ID_ME = CODIGO
